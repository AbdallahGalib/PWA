import{s as se,n as H,o as re,d as ae,e as ie,r as ce}from"../chunks/scheduler.Bvac2VuE.js";import{S as ue,i as fe,e as k,s as R,b as Z,m as de,c as w,g,h as q,d as A,f as B,n as $,o as y,k as m,j as N,l as te,p as Y}from"../chunks/index.Ji3sbTeO.js";import{L as z,e as ne,u as he,d as pe}from"../chunks/leaflet.draw.BT58w--h.js";const ge=typeof window<"u"?window:typeof globalThis<"u"?globalThis:global,{Map:me}=ge;function oe(r,e,t){const n=r.slice();return n[31]=e[t][0],n[32]=e[t][1],n}function _e(r){let e,t="Start Monitoring",n,a;return{c(){e=k("button"),e.textContent=t,this.h()},l(s){e=w(s,"BUTTON",{class:!0,"data-svelte-h":!0}),$(e)!=="svelte-8rrxot"&&(e.textContent=t),this.h()},h(){y(e,"class","control-button start svelte-ov1eb9")},m(s,o){N(s,e,o),n||(a=Y(e,"click",r[6]),n=!0)},p:H,d(s){s&&g(e),n=!1,a()}}}function ve(r){let e,t="Stop Monitoring",n,a;return{c(){e=k("button"),e.textContent=t,this.h()},l(s){e=w(s,"BUTTON",{class:!0,"data-svelte-h":!0}),$(e)!=="svelte-149dva3"&&(e.textContent=t),this.h()},h(){y(e,"class","control-button stop svelte-ov1eb9")},m(s,o){N(s,e,o),n||(a=Y(e,"click",r[7]),n=!0)},p:H,d(s){s&&g(e),n=!1,a()}}}function ye(r){let e,t=[],n=new me,a=ne(Array.from(r[1]));const s=o=>o[32].id;for(let o=0;o<a.length;o+=1){let l=oe(r,a,o),i=s(l);n.set(i,t[o]=le(i,l))}return{c(){e=k("ul");for(let o=0;o<t.length;o+=1)t[o].c();this.h()},l(o){e=w(o,"UL",{class:!0});var l=A(e);for(let i=0;i<t.length;i+=1)t[i].l(l);l.forEach(g),this.h()},h(){y(e,"class","svelte-ov1eb9")},m(o,l){N(o,e,l);for(let i=0;i<t.length;i+=1)t[i]&&t[i].m(e,null)},p(o,l){l[0]&270&&(a=ne(Array.from(o[1])),t=he(t,l,s,1,o,a,n,e,pe,le,null,oe))},d(o){o&&g(e);for(let l=0;l<t.length;l+=1)t[l].d()}}}function be(r){let e,t="No geofences created yet. Use the drawing tools to create one.";return{c(){e=k("p"),e.textContent=t,this.h()},l(n){e=w(n,"P",{class:!0,"data-svelte-h":!0}),$(e)!=="svelte-cq9e1g"&&(e.textContent=t),this.h()},h(){y(e,"class","no-geofences svelte-ov1eb9")},m(n,a){N(n,e,a)},p:H,d(n){n&&g(e)}}}function ke(r){let e,t=r[31]+"",n,a,s;function o(){return r[12](r[32],r[31])}return{c(){e=k("button"),n=Z(t),this.h()},l(l){e=w(l,"BUTTON",{class:!0});var i=A(e);n=B(i,t),i.forEach(g),this.h()},h(){y(e,"class","geofence-name-button svelte-ov1eb9")},m(l,i){N(l,e,i),m(e,n),a||(s=Y(e,"click",o),a=!0)},p(l,i){r=l,i[0]&2&&t!==(t=r[31]+"")&&te(n,t)},d(l){l&&g(e),a=!1,s()}}}function we(r){let e,t,n;function a(...s){return r[11](r[31],...s)}return{c(){e=k("input"),this.h()},l(s){e=w(s,"INPUT",{type:!0,class:!0}),this.h()},h(){y(e,"type","text"),y(e,"class","rename-input svelte-ov1eb9"),e.value=r[3]},m(s,o){N(s,e,o),t||(n=[Y(e,"input",r[10]),Y(e,"keydown",a)],t=!0)},p(s,o){r=s,o[0]&8&&e.value!==r[3]&&(e.value=r[3])},d(s){s&&g(e),t=!1,ce(n)}}}function le(r,e){let t,n,a,s,o=e[32].type+"",l,i,E;function _(h,f){return h[2]===h[32].id?we:ke}let b=_(e),d=b(e);return{key:r,first:null,c(){t=k("li"),d.c(),n=R(),a=k("span"),s=Z("("),l=Z(o),i=Z(")"),E=R(),this.h()},l(h){t=w(h,"LI",{class:!0});var f=A(t);d.l(f),n=q(f),a=w(f,"SPAN",{class:!0});var T=A(a);s=B(T,"("),l=B(T,o),i=B(T,")"),T.forEach(g),E=q(f),f.forEach(g),this.h()},h(){y(a,"class","geofence-type svelte-ov1eb9"),y(t,"class","geofence-item svelte-ov1eb9"),this.first=t},m(h,f){N(h,t,f),d.m(t,null),m(t,n),m(t,a),m(a,s),m(a,l),m(a,i),m(t,E)},p(h,f){e=h,b===(b=_(e))&&d?d.p(e,f):(d.d(1),d=b(e),d&&(d.c(),d.m(t,n))),f[0]&2&&o!==(o=e[32].type+"")&&te(l,o)},d(h){h&&g(t),d.d()}}}function Me(r){let e,t,n,a,s,o,l,i,E,_,b,d,h,f,T="Geofences",U;function S(p,I){return p[5]?ve:_e}let D=S(r),P=D(r);function F(p,I){return p[1].size===0?be:ye}let O=F(r),L=O(r);return{c(){e=k("meta"),t=R(),n=k("main"),a=k("div"),s=k("div"),o=k("div"),l=k("p"),i=Z(r[4]),E=R(),P.c(),_=R(),b=k("div"),d=R(),h=k("div"),f=k("h3"),f.textContent=T,U=R(),L.c(),this.h()},l(p){const I=de("svelte-1ps6v8r",document.head);e=w(I,"META",{name:!0,content:!0}),I.forEach(g),t=q(p),n=w(p,"MAIN",{});var K=A(n);a=w(K,"DIV",{class:!0});var J=A(a);s=w(J,"DIV",{class:!0});var V=A(s);o=w(V,"DIV",{class:!0});var j=A(o);l=w(j,"P",{class:!0});var Q=A(l);i=B(Q,r[4]),Q.forEach(g),E=q(j),P.l(j),j.forEach(g),_=q(V),b=w(V,"DIV",{class:!0}),A(b).forEach(g),d=q(V),h=w(V,"DIV",{class:!0});var W=A(h);f=w(W,"H3",{class:!0,"data-svelte-h":!0}),$(f)!=="svelte-pnijaz"&&(f.textContent=T),U=q(W),L.l(W),W.forEach(g),V.forEach(g),J.forEach(g),K.forEach(g),this.h()},h(){document.title="Geofencing PWA",y(e,"name","description"),y(e,"content","A Progressive Web App for geofencing"),y(l,"class","status-text svelte-ov1eb9"),y(o,"class","status-bar svelte-ov1eb9"),y(b,"class","map-container svelte-ov1eb9"),y(f,"class","svelte-ov1eb9"),y(h,"class","geofence-list svelte-ov1eb9"),y(s,"class","content-container svelte-ov1eb9"),y(a,"class","app-container svelte-ov1eb9")},m(p,I){m(document.head,e),N(p,t,I),N(p,n,I),m(n,a),m(a,s),m(s,o),m(o,l),m(l,i),m(o,E),P.m(o,null),m(s,_),m(s,b),r[9](b),m(s,d),m(s,h),m(h,f),m(h,U),L.m(h,null)},p(p,I){I[0]&16&&te(i,p[4]),D===(D=S(p))&&P?P.p(p,I):(P.d(1),P=D(p),P&&(P.c(),P.m(o,null))),O===(O=F(p))&&L?L.p(p,I):(L.d(1),L=O(p),L&&(L.c(),L.m(h,null)))},i:H,o:H,d(p){p&&(g(t),g(n)),g(e),P.d(),r[9](null),L.d()}}}function Ee(r,e){let t=!1;for(let n=0,a=e.length-1;n<e.length;a=n++){const s=e[n].lat,o=e[n].lng,l=e[a].lat,i=e[a].lng;o>r.lng!=i>r.lng&&r.lat<(l-s)*(r.lng-o)/(i-o)+s&&(t=!t)}return t}function Ie(r,e,t){const a=r.lat*Math.PI/180,s=e.lat*Math.PI/180,o=(e.lat-r.lat)*Math.PI/180,l=(e.lng-r.lng)*Math.PI/180,i=Math.sin(o/2)*Math.sin(o/2)+Math.cos(a)*Math.cos(s)*Math.sin(l/2)*Math.sin(l/2);return 6371e3*(2*Math.atan2(Math.sqrt(i),Math.sqrt(1-i)))<=t}function Ce(r,e,t){delete z.Icon.Default.prototype._getIconUrl,z.Icon.Default.mergeOptions({iconRetinaUrl:"/leaflet/marker-icon-2x.png",iconUrl:"/leaflet/marker-icon.png",shadowUrl:"/leaflet/marker-shadow.png"});let n=null,a,s,o=null,l=new Map,i=null,E="",_="",b=[],d=!1,h=!1,f,T,U,S=null,D="default";const P=2*60*1e3,F=z.icon({iconUrl:"https://unpkg.com/leaflet@1.7.1/dist/images/marker-icon.png",shadowUrl:"https://unpkg.com/leaflet@1.7.1/dist/images/marker-shadow.png",iconSize:[25,41],iconAnchor:[12,41],popupAnchor:[1,-34],shadowSize:[41,41]});function O(u){if(!u)return;const c=[],v=[];l.forEach((M,C)=>{let G=!1;M.type==="circle"?G=Ie(u,M.center,M.radius):(M.type==="polygon"||M.type==="rectangle")&&(G=Ee(u,M.coordinates)),G?(c.push(C),b.includes(C)||"Notification"in window&&D==="granted"&&new Notification("Geofence Alert",{body:`You have entered ${C}`,icon:"/vite.svg"})):(v.push(C),b.includes(C)&&"Notification"in window&&D==="granted"&&new Notification("Geofence Alert",{body:`You have left ${C}`,icon:"/vite.svg"}))}),b=c,b.length>0?t(4,_=`Inside geofence(s): ${b.join(", ")}`):t(4,_="Outside all geofences")}function L(){S||(S=window.setInterval(()=>{o&&O(o)},P))}function p(){S&&(window.clearInterval(S),S=null)}async function I(u){try{if(!n||!u||!u.coords)return;const{latitude:c,longitude:v,accuracy:M}=u.coords,C={lat:c,lng:v};o=C,T?T.setLatLng([c,v]):T=z.marker([c,v],{icon:F}).addTo(n),U?(U.setLatLng([c,v]),U.setRadius(M)):U=z.circle([c,v],{radius:M}).addTo(n),O(C)}catch(c){console.error("Error updating position:",c),t(4,_="Error updating position")}}async function K(){try{if(!a){console.error("Map element not found");return}n=z.map(a,{zoomControl:!0,keyboard:!0,minZoom:1,maxZoom:22,zoomDelta:.5,zoomSnap:.5}).setView([0,0],2),z.tileLayer("https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png",{attribution:" OpenStreetMap contributors",maxNativeZoom:19,maxZoom:22}).addTo(n),s=new z.FeatureGroup,n.addLayer(s);const u=new z.Control.Draw({draw:{polyline:!1,circlemarker:!1,marker:!1,circle:!0,polygon:!0,rectangle:!0},edit:{featureGroup:s,remove:!0}});n.addControl(u),n.on("draw:created",c=>{const v=c.layer;s.addLayer(v);const M=c.layerType,C=Math.random().toString(36).substr(2,9),G=`Geofence ${l.size+1}`;let ee;if(M==="circle"){const X=v.getLatLng(),x=v.getRadius();ee={id:C,name:G,type:"circle",center:{lat:X.lat,lng:X.lng},radius:x,coordinates:[],layer:v}}else{const X=v.getLatLngs()[0].map(x=>({lat:x.lat,lng:x.lng}));ee={id:C,name:G,type:M,coordinates:X,center:{lat:0,lng:0},radius:0,layer:v}}l.set(G,ee),t(1,l)}),n.on("draw:deleted",c=>{c.layers.eachLayer(M=>{l.forEach((C,G)=>{C.layer===M&&l.delete(G)})}),t(1,l)}),"geolocation"in navigator?navigator.geolocation.getCurrentPosition(c=>{const{latitude:v,longitude:M}=c.coords;n&&(n.setView([v,M],13),I(c))},c=>{console.error("Error getting location:",c),t(4,_="Error getting location. Please enable location services.")}):t(4,_="Geolocation is not supported by your browser"),h=!0}catch(u){console.error("Error initializing map:",u),t(4,_="Error initializing map. Please refresh the page.")}}async function J(){d||(t(5,d=!0),"geolocation"in navigator?(f=navigator.geolocation.watchPosition(I,u=>{console.error("Error watching position:",u),t(4,_="Error watching position"),t(5,d=!1)},{enableHighAccuracy:!0,timeout:5e3,maximumAge:0}),L(),t(4,_="Monitoring location...")):t(4,_="Geolocation is not supported by your browser"))}async function V(){d&&f!==null&&(navigator.geolocation.clearWatch(f),p(),t(5,d=!1),t(4,_="Monitoring stopped"))}function j(u,c){if(l.has(u)&&!l.has(c)){const v=l.get(u);l.delete(u),l.set(c,{...v,name:c}),t(1,l),t(2,i=null)}}re(async()=>{"Notification"in window&&(D=await Notification.requestPermission()),await K()}),ae(()=>{p(),f&&(navigator.geolocation.clearWatch(f),t(5,d=!1))});function Q(u){ie[u?"unshift":"push"](()=>{a=u,t(0,a)})}return[a,l,i,E,_,d,J,V,j,Q,u=>{const c=u.currentTarget;t(3,E=c.value)},(u,c)=>{c.key==="Enter"?j(u,E):c.key==="Escape"&&t(2,i=null)},(u,c)=>{t(2,i=u.id),t(3,E=c)}]}class ze extends ue{constructor(e){super(),fe(this,e,Ce,Me,se,{},null,[-1,-1])}}export{ze as component};

/* empty css                   */import{s as Ve,n as ve,r as ye,o as Be,d as je,e as xe}from"./chunks/scheduler.Bvac2VuE.js";import{S as Fe,i as We,e as p,s as N,b as Z,c as v,d as y,n as K,h as P,f as q,g as h,o as g,j as O,k as c,p as te,l as ie,B as be,C as we,q as Le}from"./chunks/index.Ji3sbTeO.js";import{L as R,e as ue}from"./chunks/leaflet.draw.BT58w--h.js";(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const l of document.querySelectorAll('link[rel="modulepreload"]'))t(l);new MutationObserver(l=>{for(const o of l)if(o.type==="childList")for(const s of o.addedNodes)s.tagName==="LINK"&&s.rel==="modulepreload"&&t(s)}).observe(document,{childList:!0,subtree:!0});function n(l){const o={};return l.integrity&&(o.integrity=l.integrity),l.referrerPolicy&&(o.referrerPolicy=l.referrerPolicy),l.crossOrigin==="use-credentials"?o.credentials="include":l.crossOrigin==="anonymous"?o.credentials="omit":o.credentials="same-origin",o}function t(l){if(l.ep)return;l.ep=!0;const o=n(l);fetch(l.href,o)}})();function Ne(r,e,n){const t=r.slice();return t[38]=e[n][0],t[39]=e[n][1],t}function Pe(r,e,n){const t=r.slice();return t[42]=e[n],t}function Me(r,e,n){const t=r.slice();return t[42]=e[n],t}function Te(r){let e,n,t,l,o,s,i,u;return{c(){e=p("div"),n=p("input"),t=N(),l=p("button"),o=Z("Save Geofence"),this.h()},l(f){e=v(f,"DIV",{class:!0});var a=y(e);n=v(a,"INPUT",{type:!0,placeholder:!0,class:!0}),t=P(a),l=v(a,"BUTTON",{class:!0});var d=y(l);o=q(d,"Save Geofence"),d.forEach(h),a.forEach(h),this.h()},h(){g(n,"type","text"),g(n,"placeholder","Enter geofence name"),g(n,"class","svelte-kpzu9m"),g(l,"class","success-btn svelte-kpzu9m"),l.disabled=s=!r[4],g(e,"class","geofence-controls")},m(f,a){O(f,e,a),c(e,n),be(n,r[4]),c(e,t),c(e,l),c(l,o),i||(u=[te(n,"input",r[18]),te(l,"click",r[13])],i=!0)},p(f,a){a[0]&16&&n.value!==f[4]&&be(n,f[4]),a[0]&16&&s!==(s=!f[4])&&(l.disabled=s)},d(f){f&&h(e),i=!1,ye(u)}}}function He(r){let e,n,t=r[6].length>0&&De(r),l=r[7].length>0&&Se(r);return{c(){e=p("div"),t&&t.c(),n=N(),l&&l.c(),this.h()},l(o){e=v(o,"DIV",{class:!0});var s=y(e);t&&t.l(s),n=P(s),l&&l.l(s),s.forEach(h),this.h()},h(){g(e,"class","status-grid svelte-kpzu9m")},m(o,s){O(o,e,s),t&&t.m(e,null),c(e,n),l&&l.m(e,null)},p(o,s){o[6].length>0?t?t.p(o,s):(t=De(o),t.c(),t.m(e,n)):t&&(t.d(1),t=null),o[7].length>0?l?l.p(o,s):(l=Se(o),l.c(),l.m(e,null)):l&&(l.d(1),l=null)},d(o){o&&h(e),t&&t.d(),l&&l.d()}}}function Re(r){let e,n="Waiting for location...";return{c(){e=p("p"),e.textContent=n,this.h()},l(t){e=v(t,"P",{class:!0,"data-svelte-h":!0}),K(e)!=="svelte-1y1nut4"&&(e.textContent=n),this.h()},h(){g(e,"class","no-data svelte-kpzu9m")},m(t,l){O(t,e,l)},p:ve,d(t){t&&h(e)}}}function Ze(r){let e,n="No geofences defined yet";return{c(){e=p("p"),e.textContent=n,this.h()},l(t){e=v(t,"P",{class:!0,"data-svelte-h":!0}),K(e)!=="svelte-vnpbua"&&(e.textContent=n),this.h()},h(){g(e,"class","no-data svelte-kpzu9m")},m(t,l){O(t,e,l)},p:ve,d(t){t&&h(e)}}}function De(r){let e,n,t="Inside Geofences:",l,o,s=ue(r[6]),i=[];for(let u=0;u<s.length;u+=1)i[u]=Ge(Me(r,s,u));return{c(){e=p("div"),n=p("h4"),n.textContent=t,l=N(),o=p("ul");for(let u=0;u<i.length;u+=1)i[u].c();this.h()},l(u){e=v(u,"DIV",{class:!0});var f=y(e);n=v(f,"H4",{class:!0,"data-svelte-h":!0}),K(n)!=="svelte-gj6rvb"&&(n.textContent=t),l=P(f),o=v(f,"UL",{class:!0});var a=y(o);for(let d=0;d<i.length;d+=1)i[d].l(a);a.forEach(h),f.forEach(h),this.h()},h(){g(n,"class","svelte-kpzu9m"),g(o,"class","svelte-kpzu9m"),g(e,"class","status-section inside svelte-kpzu9m")},m(u,f){O(u,e,f),c(e,n),c(e,l),c(e,o);for(let a=0;a<i.length;a+=1)i[a]&&i[a].m(o,null)},p(u,f){if(f[0]&64){s=ue(u[6]);let a;for(a=0;a<s.length;a+=1){const d=Me(u,s,a);i[a]?i[a].p(d,f):(i[a]=Ge(d),i[a].c(),i[a].m(o,null))}for(;a<i.length;a+=1)i[a].d(1);i.length=s.length}},d(u){u&&h(e),we(i,u)}}}function Ge(r){let e,n=r[42]+"",t;return{c(){e=p("li"),t=Z(n)},l(l){e=v(l,"LI",{});var o=y(e);t=q(o,n),o.forEach(h)},m(l,o){O(l,e,o),c(e,t)},p(l,o){o[0]&64&&n!==(n=l[42]+"")&&ie(t,n)},d(l){l&&h(e)}}}function Se(r){let e,n,t="Outside Geofences:",l,o,s=ue(r[7]),i=[];for(let u=0;u<s.length;u+=1)i[u]=Ae(Pe(r,s,u));return{c(){e=p("div"),n=p("h4"),n.textContent=t,l=N(),o=p("ul");for(let u=0;u<i.length;u+=1)i[u].c();this.h()},l(u){e=v(u,"DIV",{class:!0});var f=y(e);n=v(f,"H4",{class:!0,"data-svelte-h":!0}),K(n)!=="svelte-r37asg"&&(n.textContent=t),l=P(f),o=v(f,"UL",{class:!0});var a=y(o);for(let d=0;d<i.length;d+=1)i[d].l(a);a.forEach(h),f.forEach(h),this.h()},h(){g(n,"class","svelte-kpzu9m"),g(o,"class","svelte-kpzu9m"),g(e,"class","status-section outside svelte-kpzu9m")},m(u,f){O(u,e,f),c(e,n),c(e,l),c(e,o);for(let a=0;a<i.length;a+=1)i[a]&&i[a].m(o,null)},p(u,f){if(f[0]&128){s=ue(u[7]);let a;for(a=0;a<s.length;a+=1){const d=Pe(u,s,a);i[a]?i[a].p(d,f):(i[a]=Ae(d),i[a].c(),i[a].m(o,null))}for(;a<i.length;a+=1)i[a].d(1);i.length=s.length}},d(u){u&&h(e),we(i,u)}}}function Ae(r){let e,n=r[42]+"",t;return{c(){e=p("li"),t=Z(n)},l(l){e=v(l,"LI",{});var o=y(e);t=q(o,n),o.forEach(h)},m(l,o){O(l,e,o),c(e,t)},p(l,o){o[0]&128&&n!==(n=l[42]+"")&&ie(t,n)},d(l){l&&h(e)}}}function qe(r){let e,n=ue(Array.from(r[2])),t=[];for(let l=0;l<n.length;l+=1)t[l]=Oe(Ne(r,n,l));return{c(){for(let l=0;l<t.length;l+=1)t[l].c();e=Le()},l(l){for(let o=0;o<t.length;o+=1)t[o].l(l);e=Le()},m(l,o){for(let s=0;s<t.length;s+=1)t[s]&&t[s].m(l,o);O(l,e,o)},p(l,o){if(o[0]&116228){n=ue(Array.from(l[2]));let s;for(s=0;s<n.length;s+=1){const i=Ne(l,n,s);t[s]?t[s].p(i,o):(t[s]=Oe(i),t[s].c(),t[s].m(e.parentNode,e))}for(;s<t.length;s+=1)t[s].d(1);t.length=n.length}},d(l){l&&h(e),we(t,l)}}}function Ke(r){let e,n="No geofences saved";return{c(){e=p("p"),e.textContent=n,this.h()},l(t){e=v(t,"P",{class:!0,"data-svelte-h":!0}),K(e)!=="svelte-196347e"&&(e.textContent=n),this.h()},h(){g(e,"class","no-data svelte-kpzu9m")},m(t,l){O(t,e,l)},p:ve,d(t){t&&h(e)}}}function Ye(r){let e,n=r[38]+"",t,l,o,s,i="Rename",u,f,a="Delete",d,w;function F(){return r[21](r[38])}function j(){return r[22](r[38])}return{c(){e=p("span"),t=Z(n),l=N(),o=p("div"),s=p("button"),s.textContent=i,u=N(),f=p("button"),f.textContent=a,this.h()},l(k){e=v(k,"SPAN",{});var z=y(e);t=q(z,n),z.forEach(h),l=P(k),o=v(k,"DIV",{class:!0});var U=y(o);s=v(U,"BUTTON",{class:!0,"data-svelte-h":!0}),K(s)!=="svelte-5y0v7o"&&(s.textContent=i),u=P(U),f=v(U,"BUTTON",{class:!0,"data-svelte-h":!0}),K(f)!=="svelte-upu1cn"&&(f.textContent=a),U.forEach(h),this.h()},h(){g(s,"class","edit-btn svelte-kpzu9m"),g(f,"class","danger-btn svelte-kpzu9m"),g(o,"class","button-group svelte-kpzu9m")},m(k,z){O(k,e,z),c(e,t),O(k,l,z),O(k,o,z),c(o,s),c(o,u),c(o,f),d||(w=[te(s,"click",F),te(f,"click",j)],d=!0)},p(k,z){r=k,z[0]&4&&n!==(n=r[38]+"")&&ie(t,n)},d(k){k&&(h(e),h(l),h(o)),d=!1,ye(w)}}}function Je(r){let e,n,t,l,o="Save",s,i,u="Cancel",f,a;return{c(){e=p("input"),n=N(),t=p("div"),l=p("button"),l.textContent=o,s=N(),i=p("button"),i.textContent=u,this.h()},l(d){e=v(d,"INPUT",{type:!0,placeholder:!0,class:!0}),n=P(d),t=v(d,"DIV",{class:!0});var w=y(t);l=v(w,"BUTTON",{class:!0,"data-svelte-h":!0}),K(l)!=="svelte-mswtrf"&&(l.textContent=o),s=P(w),i=v(w,"BUTTON",{class:!0,"data-svelte-h":!0}),K(i)!=="svelte-1gsjooy"&&(i.textContent=u),w.forEach(h),this.h()},h(){g(e,"type","text"),g(e,"placeholder","Enter new name"),g(e,"class","rename-input svelte-kpzu9m"),g(l,"class","success-btn svelte-kpzu9m"),g(i,"class","secondary-btn svelte-kpzu9m"),g(t,"class","button-group svelte-kpzu9m")},m(d,w){O(d,e,w),be(e,r[10]),O(d,n,w),O(d,t,w),c(t,l),c(t,s),c(t,i),f||(a=[te(e,"input",r[19]),te(l,"click",r[16]),te(i,"click",r[20])],f=!0)},p(d,w){w[0]&1024&&e.value!==d[10]&&be(e,d[10])},d(d){d&&(h(e),h(n),h(t)),f=!1,ye(a)}}}function Oe(r){let e,n;function t(s,i){return s[9]===s[38]?Je:Ye}let l=t(r),o=l(r);return{c(){e=p("div"),o.c(),n=N(),this.h()},l(s){e=v(s,"DIV",{class:!0});var i=y(e);o.l(i),n=P(i),i.forEach(h),this.h()},h(){g(e,"class","geofence-item svelte-kpzu9m")},m(s,i){O(s,e,i),o.m(e,null),c(e,n)},p(s,i){l===(l=t(s))&&o?o.p(s,i):(o.d(1),o=l(s),o&&(o.c(),o.m(e,n)))},d(s){s&&h(e),o.d()}}}function Ue(r){let e,n,t="Current Position",l,o,s,i,u="Latitude:",f,a,d=r[1].lat.toFixed(6)+"",w,F,j,k,z,U="Longitude:",Y,x,W=r[1].lng.toFixed(6)+"",J,Q;return{c(){e=p("div"),n=p("h3"),n.textContent=t,l=N(),o=p("div"),s=p("div"),i=p("span"),i.textContent=u,f=N(),a=p("span"),w=Z(d),F=Z("째"),j=N(),k=p("div"),z=p("span"),z.textContent=U,Y=N(),x=p("span"),J=Z(W),Q=Z("째"),this.h()},l(M){e=v(M,"DIV",{class:!0});var G=y(e);n=v(G,"H3",{class:!0,"data-svelte-h":!0}),K(n)!=="svelte-rkwjkw"&&(n.textContent=t),l=P(G),o=v(G,"DIV",{class:!0});var H=y(o);s=v(H,"DIV",{class:!0});var X=y(s);i=v(X,"SPAN",{class:!0,"data-svelte-h":!0}),K(i)!=="svelte-1c1l89t"&&(i.textContent=u),f=P(X),a=v(X,"SPAN",{class:!0});var ee=y(a);w=q(ee,d),F=q(ee,"째"),ee.forEach(h),X.forEach(h),j=P(H),k=v(H,"DIV",{class:!0});var $=y(k);z=v($,"SPAN",{class:!0,"data-svelte-h":!0}),K(z)!=="svelte-1tmjtgi"&&(z.textContent=U),Y=P($),x=v($,"SPAN",{class:!0});var T=y(x);J=q(T,W),Q=q(T,"째"),T.forEach(h),$.forEach(h),H.forEach(h),G.forEach(h),this.h()},h(){g(n,"class","svelte-kpzu9m"),g(i,"class","label svelte-kpzu9m"),g(a,"class","value svelte-kpzu9m"),g(s,"class","position-item svelte-kpzu9m"),g(z,"class","label svelte-kpzu9m"),g(x,"class","value svelte-kpzu9m"),g(k,"class","position-item svelte-kpzu9m"),g(o,"class","position-grid svelte-kpzu9m"),g(e,"class","position-info svelte-kpzu9m")},m(M,G){O(M,e,G),c(e,n),c(e,l),c(e,o),c(o,s),c(s,i),c(s,f),c(s,a),c(a,w),c(a,F),c(o,j),c(o,k),c(k,z),c(k,Y),c(k,x),c(x,J),c(x,Q)},p(M,G){G[0]&2&&d!==(d=M[1].lat.toFixed(6)+"")&&ie(w,d),G[0]&2&&W!==(W=M[1].lng.toFixed(6)+"")&&ie(J,W)},d(M){M&&h(e)}}}function Qe(r){let e,n,t,l,o="Geofence PWA",s,i,u,f,a,d,w,F,j,k,z,U,Y,x,W,J,Q,M,G,H,X="Geofence Status",ee,$,T,A,re,ne=r[2].size+"",ae,fe,de,he,ge,Ce,B=r[3]&&Te(r);function m(C,V){return C[2].size===0?Ze:C[1]?He:Re}let L=m(r),b=L(r);function _(C,V){return C[2].size===0?Ke:qe}let E=_(r),D=E(r),I=r[1]&&Ue(r);return{c(){e=p("main"),n=p("div"),t=p("div"),l=p("h1"),l.textContent=o,s=N(),i=p("div"),u=p("p"),f=Z(r[5]),a=N(),d=p("div"),w=p("button"),F=Z("Start Monitoring"),j=N(),k=p("button"),z=Z("Stop Monitoring"),Y=N(),x=p("div"),W=p("div"),J=N(),B&&B.c(),Q=N(),M=p("div"),G=p("div"),H=p("h3"),H.textContent=X,ee=N(),b.c(),$=N(),T=p("div"),A=p("h3"),re=Z("Saved Geofences ("),ae=Z(ne),fe=Z(")"),de=N(),D.c(),he=N(),I&&I.c(),this.h()},l(C){e=v(C,"MAIN",{class:!0});var V=y(e);n=v(V,"DIV",{class:!0});var oe=y(n);t=v(oe,"DIV",{class:!0});var S=y(t);l=v(S,"H1",{class:!0,"data-svelte-h":!0}),K(l)!=="svelte-1t5vslm"&&(l.textContent=o),s=P(S),i=v(S,"DIV",{class:!0});var le=y(i);u=v(le,"P",{});var pe=y(u);f=q(pe,r[5]),pe.forEach(h),le.forEach(h),a=P(S),d=v(S,"DIV",{class:!0});var se=y(d);w=v(se,"BUTTON",{class:!0});var ze=y(w);F=q(ze,"Start Monitoring"),ze.forEach(h),j=P(se),k=v(se,"BUTTON",{class:!0});var Ee=y(k);z=q(Ee,"Stop Monitoring"),Ee.forEach(h),se.forEach(h),Y=P(S),x=v(S,"DIV",{class:!0});var Ie=y(x);W=v(Ie,"DIV",{class:!0}),y(W).forEach(h),Ie.forEach(h),J=P(S),B&&B.l(S),Q=P(S),M=v(S,"DIV",{class:!0});var ce=y(M);G=v(ce,"DIV",{class:!0});var me=y(G);H=v(me,"H3",{class:!0,"data-svelte-h":!0}),K(H)!=="svelte-1lz0k2u"&&(H.textContent=X),ee=P(me),b.l(me),me.forEach(h),$=P(ce),T=v(ce,"DIV",{class:!0});var _e=y(T);A=v(_e,"H3",{class:!0});var ke=y(A);re=q(ke,"Saved Geofences ("),ae=q(ke,ne),fe=q(ke,")"),ke.forEach(h),de=P(_e),D.l(_e),_e.forEach(h),he=P(ce),I&&I.l(ce),ce.forEach(h),S.forEach(h),oe.forEach(h),V.forEach(h),this.h()},h(){g(l,"class","svelte-kpzu9m"),g(i,"class","status-bar svelte-kpzu9m"),g(w,"class","primary-btn svelte-kpzu9m"),w.disabled=r[8],g(k,"class","secondary-btn svelte-kpzu9m"),k.disabled=U=!r[8],g(d,"class","control-panel svelte-kpzu9m"),g(W,"class","map-container svelte-kpzu9m"),g(x,"class","map-section svelte-kpzu9m"),g(H,"class","svelte-kpzu9m"),g(G,"class","geofence-status svelte-kpzu9m"),g(A,"class","svelte-kpzu9m"),g(T,"class","geofence-list svelte-kpzu9m"),g(M,"class","info-panel svelte-kpzu9m"),g(t,"class","content-container svelte-kpzu9m"),g(n,"class","app-container svelte-kpzu9m"),g(e,"class","svelte-kpzu9m")},m(C,V){O(C,e,V),c(e,n),c(n,t),c(t,l),c(t,s),c(t,i),c(i,u),c(u,f),c(t,a),c(t,d),c(d,w),c(w,F),c(d,j),c(d,k),c(k,z),c(t,Y),c(t,x),c(x,W),r[17](W),c(t,J),B&&B.m(t,null),c(t,Q),c(t,M),c(M,G),c(G,H),c(G,ee),b.m(G,null),c(M,$),c(M,T),c(T,A),c(A,re),c(A,ae),c(A,fe),c(T,de),D.m(T,null),c(M,he),I&&I.m(M,null),ge||(Ce=[te(w,"click",r[11]),te(k,"click",r[12])],ge=!0)},p(C,V){V[0]&32&&ie(f,C[5]),V[0]&256&&(w.disabled=C[8]),V[0]&256&&U!==(U=!C[8])&&(k.disabled=U),C[3]?B?B.p(C,V):(B=Te(C),B.c(),B.m(t,Q)):B&&(B.d(1),B=null),L===(L=m(C))&&b?b.p(C,V):(b.d(1),b=L(C),b&&(b.c(),b.m(G,null))),V[0]&4&&ne!==(ne=C[2].size+"")&&ie(ae,ne),E===(E=_(C))&&D?D.p(C,V):(D.d(1),D=E(C),D&&(D.c(),D.m(T,null))),C[1]?I?I.p(C,V):(I=Ue(C),I.c(),I.m(M,null)):I&&(I.d(1),I=null)},i:ve,o:ve,d(C){C&&h(e),r[17](null),B&&B.d(),b.d(),D.d(),I&&I.d(),ge=!1,ye(Ce)}}}function Xe(r,e){let n=!1;for(let t=0,l=e.length-1;t<e.length;l=t++){const o=e[t].lat,s=e[t].lng,i=e[l].lat,u=e[l].lng;s>r.lng!=u>r.lng&&r.lat<(i-o)*(r.lng-s)/(u-s)+o&&(n=!n)}return n}function $e(r,e,n){const l=r.lat*Math.PI/180,o=e.lat*Math.PI/180,s=(e.lat-r.lat)*Math.PI/180,i=(e.lng-r.lng)*Math.PI/180,u=Math.sin(s/2)*Math.sin(s/2)+Math.cos(l)*Math.cos(o)*Math.sin(i/2)*Math.sin(i/2);return 6371e3*(2*Math.atan2(Math.sqrt(u),Math.sqrt(1-u)))<=n}function et(r,e,n){delete R.Icon.Default.prototype._getIconUrl,R.Icon.Default.mergeOptions({iconRetinaUrl:"/leaflet/marker-icon-2x.png",iconUrl:"/leaflet/marker-icon.png",shadowUrl:"/leaflet/marker-shadow.png"});let t=null,l,o,s=null,i=new Map,u=null,f="",a="",d=[],w=[],F=!1,j,k,z,U=null,Y="default";const x=2*60*1e3,W=R.icon({iconUrl:"https://unpkg.com/leaflet@1.7.1/dist/images/marker-icon.png",shadowUrl:"https://unpkg.com/leaflet@1.7.1/dist/images/marker-shadow.png",iconSize:[25,41],iconAnchor:[12,41],popupAnchor:[1,-34],shadowSize:[41,41]});function J(m){if(!m)return;const L=[],b=[];i.forEach((_,E)=>{let D=!1;_.type==="circle"?D=$e(m,_.center,_.radius):(_.type==="polygon"||_.type==="rectangle")&&(D=Xe(m,_.coordinates)),D?(L.push(E),d.includes(E)||"Notification"in window&&Y==="granted"&&new Notification("Geofence Alert",{body:`You have entered ${E}`,icon:"/vite.svg"})):(b.push(E),d.includes(E)&&"Notification"in window&&Y==="granted"&&new Notification("Geofence Alert",{body:`You have left ${E}`,icon:"/vite.svg"}))}),n(6,d=L),n(7,w=b),d.length>0?n(5,a=`Inside geofence(s): ${d.join(", ")}`):n(5,a="Outside all geofences")}function Q(){U||(U=window.setInterval(()=>{s&&J(s)},x))}function M(){U&&(window.clearInterval(U),U=null)}async function G(m){var L;try{if(!t||!m||!m.coords)return;const{latitude:b,longitude:_,accuracy:E}=m.coords,D={lat:b,lng:_};if(n(1,s=D),k?k.setLatLng([b,_]):k=R.marker([b,_],{icon:W}).addTo(t),z?(z.setLatLng([b,_]),z.setRadius(E)):z=R.circle([b,_],{radius:E}).addTo(t),J(D),"serviceWorker"in navigator){const I=await navigator.serviceWorker.ready,C={timestamp:new Date().getTime(),coords:{lat:b,lng:_,accuracy:E},isInsideGeofence:d.length>0,geofenceName:d.join(", ")};(L=I.active)==null||L.postMessage({type:"store-location",location:C});try{"sync"in I&&await I.sync.register("location-sync")}catch(V){console.warn("Background sync failed:",V)}}n(5,a=d.length>0?`Inside geofence(s): ${d.join(", ")}`:"Outside all geofences")}catch(b){console.error("Error updating position:",b),n(5,a="Error updating position")}}async function H(){try{if(!l){console.error("Map element not found");return}t=R.map(l,{zoomControl:!0,keyboard:!0,minZoom:1,maxZoom:22,zoomDelta:.5,zoomSnap:.5,wheelDebounceTime:40}).setView([0,0],2),R.control.scale().addTo(t);const m=R.Control.extend({onAdd(b){const _=R.DomUtil.create("div","leaflet-control leaflet-control-zoom-info");return _.style.backgroundColor="white",_.style.padding="5px",_.style.margin="10px",_.style.border="2px solid rgba(0,0,0,0.2)",_.style.borderRadius="4px",_.innerHTML=`Zoom: ${b.getZoom()}`,b.on("zoomend",()=>{_.innerHTML=`Zoom: ${b.getZoom()}`}),_}});new m({position:"bottomleft"}).addTo(t),R.tileLayer("https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png",{attribution:" OpenStreetMap contributors",maxNativeZoom:19,maxZoom:22}).addTo(t),o=new R.FeatureGroup,t.addLayer(o);const L=new R.Control.Draw({draw:{polyline:!1,rectangle:!1,polygon:{allowIntersection:!1,shapeOptions:{color:"#4CAF50",fillColor:"#4CAF50",fillOpacity:.2}},circle:{shapeOptions:{color:"#4CAF50",fillColor:"#4CAF50",fillOpacity:.2}},marker:!1},edit:{featureGroup:o}});t.addControl(L),t.on("draw:created",b=>{const _=b.layer,E=b.layerType;if(E==="circle"){const S=_.getRadius();_.bindTooltip(`Radius: ${S.toFixed(2)}m`)}else if(E==="polygon"||E==="rectangle"){const S=_.getLatLngs()[0],le=R.GeometryUtil.geodesicArea(S);_.bindTooltip(`Area: ${le.toFixed(2)}m짼`)}let D,I,C=[];if(E==="circle"){const S=_.getLatLng();D={lat:S.lat,lng:S.lng},I=_.getRadius()}else{C=_.getLatLngs()[0].map(se=>({lat:se.lat,lng:se.lng}));const le=_.getBounds(),pe=le.getCenter();D={lat:pe.lat,lng:pe.lng},I=le.getNorthEast().distanceTo(le.getCenter())}const oe={id:crypto.randomUUID(),name:f||`Geofence ${i.size+1}`,coordinates:C,type:E,center:D,radius:I,layer:_};_.geofenceName=oe.name,i.set(oe.name,oe),n(2,i),o.addLayer(_),n(5,a=`Created geofence: ${oe.name}`),n(4,f="")}),"geolocation"in navigator&&navigator.geolocation.getCurrentPosition(b=>{const{latitude:_,longitude:E}=b.coords;t&&(t.setView([_,E],13),k?k.setLatLng([_,E]):k=R.marker([_,E],{icon:W}).addTo(t))},b=>{console.error("Error getting location:",b),n(5,a="Error getting location. Using default view.")}),X()}catch(m){console.error("Error initializing map:",m),n(5,a="Error initializing map. Please refresh the page.")}}async function X(){F||(n(8,F=!0),"Notification"in window&&Y==="default"&&(Y=await Notification.requestPermission().then(m=>m)),Q(),"geolocation"in navigator&&(j=navigator.geolocation.watchPosition(G,m=>{console.error("Error watching position:",m),n(5,a="Error watching position")},{enableHighAccuracy:!0,timeout:5e3,maximumAge:0})))}function ee(){j&&(navigator.geolocation.clearWatch(j),j=null,n(8,F=!1),n(5,a="Monitoring stopped"))}function $(){}let T=null,A="";function re(m){const L=i.get(m);L&&L.layer&&o.removeLayer(L.layer),i.delete(m),n(2,i),J(s)}function ne(m){n(9,T=m);const L=i.get(m);L&&n(10,A=L.name)}function ae(){if(T&&A&&A!==T){const m=i.get(T);m&&(i.delete(T),m.name=A,i.set(A,m),n(2,i),J(s))}n(9,T=null),n(10,A="")}Be(async()=>{try{if(Y=await Notification.requestPermission().then(m=>m),"serviceWorker"in navigator){const m=await navigator.serviceWorker.ready;if("periodicSync"in m)try{await m.periodicSync.register("periodic-geofence-check",{minInterval:15*60*1e3})}catch(L){console.warn("Periodic background sync could not be registered:",L)}if("sync"in m)try{await m.sync.register("location-sync")}catch(L){console.warn("Background sync could not be registered:",L)}}await H()}catch(m){console.error("Error in onMount:",m),n(5,a="Error initializing the application. Please refresh the page.")}}),je(()=>{M(),j&&(navigator.geolocation.clearWatch(j),n(8,F=!1)),t&&(t.remove(),t=null)});function fe(m){xe[m?"unshift":"push"](()=>{l=m,n(0,l)})}function de(){f=this.value,n(4,f)}function he(){A=this.value,n(10,A)}return[l,s,i,u,f,a,d,w,F,T,A,X,ee,$,re,ne,ae,fe,de,he,()=>{n(9,T=null),n(10,A="")},m=>ne(m),m=>re(m)]}class tt extends Fe{constructor(e){super(),We(this,e,et,Qe,Ve,{},null,[-1,-1])}}new tt({target:document.getElementById("app")});"serviceWorker"in navigator&&window.addEventListener("load",async()=>{try{const r=await navigator.serviceWorker.register("/service-worker.js");console.log("ServiceWorker registration successful with scope:",r.scope)}catch(r){console.error("ServiceWorker registration failed:",r)}});
